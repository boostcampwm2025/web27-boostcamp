{
  "annotations": {
    "list": []
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": null,
  "links": [],
  "panels": [
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 },
      "id": 1,
      "panels": [],
      "title": "상태",
      "type": "row"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "red", "value": null },
              { "color": "green", "value": 1 }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": { "h": 4, "w": 6, "x": 0, "y": 1 },
      "id": 2,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "textMode": "auto"
      },
      "targets": [
        {
          "expr": "max(up{job=\"backend-app\",instance=~\"$backend\"})",
          "legendFormat": "backend-app",
          "refId": "A"
        }
      ],
      "title": "백엔드 UP",
      "type": "stat"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "red", "value": null },
              { "color": "green", "value": 1 }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": { "h": 4, "w": 6, "x": 6, "y": 1 },
      "id": 3,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "textMode": "auto"
      },
      "targets": [
        {
          "expr": "sum(up{job=\"node-exporter\",instance=~\"$node\"})",
          "legendFormat": "node-exporter",
          "refId": "A"
        }
      ],
      "title": "노드 Exporter UP (개수)",
      "type": "stat"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "red", "value": null },
              { "color": "green", "value": 1 }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": { "h": 4, "w": 6, "x": 12, "y": 1 },
      "id": 4,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "textMode": "auto"
      },
      "targets": [
        {
          "expr": "max(up{job=\"nginx-exporter\",instance=~\"$nginx\"})",
          "legendFormat": "nginx-exporter",
          "refId": "A"
        }
      ],
      "title": "Nginx Exporter UP",
      "type": "stat"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 5 },
      "id": 10,
      "panels": [],
      "title": "백엔드 HTTP",
      "type": "row"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": { "unit": "ops" },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 6 },
      "id": 11,
      "targets": [
        {
          "expr": "sum(rate(boostad_http_requests_total{job=\"backend-app\",instance=~\"$backend\"}[1m]))",
          "legendFormat": "RPS",
          "refId": "A"
        }
      ],
      "title": "초당 요청 수 (RPS)",
      "type": "timeseries"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": { "unit": "s" },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 6 },
      "id": 12,
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum(rate(boostad_http_request_duration_seconds_bucket{job=\"backend-app\",instance=~\"$backend\"}[5m])) by (le))",
          "legendFormat": "p95",
          "refId": "A"
        }
      ],
      "title": "HTTP 지연시간 p95 (초)",
      "type": "timeseries"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": { "unit": "percentunit", "min": 0, "max": 1 },
        "overrides": []
      },
      "gridPos": { "h": 6, "w": 8, "x": 0, "y": 14 },
      "id": 13,
      "targets": [
        {
          "expr": "sum(rate(boostad_http_requests_total{job=\"backend-app\",status_code=~\"5..\",instance=~\"$backend\"}[5m])) / sum(rate(boostad_http_requests_total{job=\"backend-app\",instance=~\"$backend\"}[5m]))",
          "legendFormat": "5xx 비율",
          "refId": "A"
        }
      ],
      "title": "5xx 비율",
      "type": "timeseries"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": { "unit": "none", "min": 0 },
        "overrides": []
      },
      "gridPos": { "h": 6, "w": 8, "x": 8, "y": 14 },
      "id": 14,
      "targets": [
        {
          "expr": "boostad_http_in_flight_requests{job=\"backend-app\",instance=~\"$backend\"}",
          "legendFormat": "inflight",
          "refId": "A"
        }
      ],
      "title": "처리 중 HTTP 요청 (inflight)",
      "type": "timeseries"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": { "defaults": { "unit": "ops" }, "overrides": [] },
      "gridPos": { "h": 6, "w": 8, "x": 16, "y": 14 },
      "id": 15,
      "options": {
        "showHeader": true
      },
      "targets": [
        {
          "expr": "topk(10, sum by (route) (rate(boostad_http_requests_total{job=\"backend-app\",instance=~\"$backend\"}[5m])))",
          "format": "table",
          "legendFormat": "{{route}}",
          "refId": "A"
        }
      ],
      "title": "라우트별 RPS Top10 (5m)",
      "transformations": [
        {
          "id": "organize",
          "options": {
            "excludeByName": { "Time": true },
            "indexByName": {},
            "renameByName": { "Value": "RPS", "route": "라우트" }
          }
        }
      ],
      "type": "table"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 20 },
      "id": 20,
      "panels": [],
      "title": "SSE",
      "type": "row"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": { "defaults": { "unit": "none", "min": 0 }, "overrides": [] },
      "gridPos": { "h": 6, "w": 12, "x": 0, "y": 21 },
      "id": 21,
      "targets": [
        {
          "expr": "boostad_sse_connections{job=\"backend-app\",stream=\"bidlog\",instance=~\"$backend\"}",
          "legendFormat": "bidlog",
          "refId": "A"
        }
      ],
      "title": "실시간 연결 수 (bidlog SSE)",
      "type": "timeseries"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "mappings": [],
          "min": 0,
          "unit": "none"
        },
        "overrides": []
      },
      "gridPos": { "h": 6, "w": 12, "x": 12, "y": 21 },
      "id": 22,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "textMode": "auto"
      },
      "targets": [
        {
          "expr": "boostad_sse_connections{job=\"backend-app\",stream=\"bidlog\",instance=~\"$backend\"}",
          "legendFormat": "현재",
          "refId": "A"
        }
      ],
      "title": "실시간 연결 수 (현재값)",
      "type": "stat"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 27 },
      "id": 30,
      "panels": [],
      "title": "Nginx",
      "type": "row"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": { "defaults": { "unit": "none", "min": 0 }, "overrides": [] },
      "gridPos": { "h": 6, "w": 8, "x": 0, "y": 28 },
      "id": 31,
      "targets": [
        {
          "expr": "nginx_connections_active{job=\"nginx-exporter\",instance=~\"$nginx\"}",
          "legendFormat": "active",
          "refId": "A"
        }
      ],
      "title": "활성 연결 (active)",
      "type": "timeseries"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": { "defaults": { "unit": "ops" }, "overrides": [] },
      "gridPos": { "h": 6, "w": 8, "x": 8, "y": 28 },
      "id": 32,
      "targets": [
        {
          "expr": "sum(rate(nginx_http_requests_total{job=\"nginx-exporter\",instance=~\"$nginx\"}[1m]))",
          "legendFormat": "req/s",
          "refId": "A"
        }
      ],
      "title": "요청 처리량 (req/s)",
      "type": "timeseries"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": { "defaults": { "unit": "none", "min": 0 }, "overrides": [] },
      "gridPos": { "h": 6, "w": 8, "x": 16, "y": 28 },
      "id": 33,
      "targets": [
        {
          "expr": "nginx_connections_reading{job=\"nginx-exporter\",instance=~\"$nginx\"}",
          "legendFormat": "reading",
          "refId": "A"
        },
        {
          "expr": "nginx_connections_writing{job=\"nginx-exporter\",instance=~\"$nginx\"}",
          "legendFormat": "writing",
          "refId": "B"
        },
        {
          "expr": "nginx_connections_waiting{job=\"nginx-exporter\",instance=~\"$nginx\"}",
          "legendFormat": "waiting",
          "refId": "C"
        }
      ],
      "title": "연결 상태 (reading/writing/waiting)",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 34 },
      "id": 40,
      "panels": [],
      "title": "서버 리소스 (node_exporter)",
      "type": "row"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": { "defaults": { "unit": "percent", "min": 0, "max": 100 }, "overrides": [] },
      "gridPos": { "h": 8, "w": 8, "x": 0, "y": 35 },
      "id": 41,
      "targets": [
        {
          "expr": "100 - (avg by (instance) (rate(node_cpu_seconds_total{job=\"node-exporter\",mode=\"idle\",instance=~\"$node\"}[5m])) * 100)",
          "legendFormat": "{{instance}}",
          "refId": "A"
        }
      ],
      "title": "CPU 사용률(%)",
      "type": "timeseries"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": { "defaults": { "unit": "percent", "min": 0, "max": 100 }, "overrides": [] },
      "gridPos": { "h": 8, "w": 8, "x": 8, "y": 35 },
      "id": 42,
      "targets": [
        {
          "expr": "100 - (node_memory_MemAvailable_bytes{job=\"node-exporter\",instance=~\"$node\"} / node_memory_MemTotal_bytes{job=\"node-exporter\",instance=~\"$node\"} * 100)",
          "legendFormat": "{{instance}}",
          "refId": "A"
        }
      ],
      "title": "메모리 사용률(%)",
      "type": "timeseries"
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": { "defaults": { "unit": "percent", "min": 0, "max": 100 }, "overrides": [] },
      "gridPos": { "h": 8, "w": 8, "x": 16, "y": 35 },
      "id": 43,
      "targets": [
        {
          "expr": "100 - (node_filesystem_avail_bytes{job=\"node-exporter\",mountpoint=\"/\",fstype!~\"tmpfs|overlay\",instance=~\"$node\"} / node_filesystem_size_bytes{job=\"node-exporter\",mountpoint=\"/\",fstype!~\"tmpfs|overlay\",instance=~\"$node\"} * 100)",
          "legendFormat": "{{instance}}",
          "refId": "A"
        }
      ],
      "title": "디스크 사용률(/)(%)",
      "type": "timeseries"
    }
  ],
  "refresh": "10s",
  "schemaVersion": 39,
  "style": "dark",
  "tags": ["boostad", "monitoring"],
  "templating": {
    "list": [
      {
        "datasource": "Prometheus",
        "definition": "label_values(up{job=\"backend-app\"}, instance)",
        "hide": 0,
        "includeAll": true,
        "label": "백엔드 인스턴스",
        "multi": true,
        "name": "backend",
        "query": { "query": "label_values(up{job=\"backend-app\"}, instance)", "refId": "StandardVariableQuery" },
        "refresh": 1,
        "sort": 1,
        "type": "query"
      },
      {
        "datasource": "Prometheus",
        "definition": "label_values(up{job=\"node-exporter\"}, instance)",
        "hide": 0,
        "includeAll": true,
        "label": "노드 인스턴스",
        "multi": true,
        "name": "node",
        "query": { "query": "label_values(up{job=\"node-exporter\"}, instance)", "refId": "StandardVariableQuery" },
        "refresh": 1,
        "sort": 1,
        "type": "query"
      },
      {
        "datasource": "Prometheus",
        "definition": "label_values(up{job=\"nginx-exporter\"}, instance)",
        "hide": 0,
        "includeAll": true,
        "label": "Nginx Exporter 인스턴스",
        "multi": true,
        "name": "nginx",
        "query": { "query": "label_values(up{job=\"nginx-exporter\"}, instance)", "refId": "StandardVariableQuery" },
        "refresh": 1,
        "sort": 1,
        "type": "query"
      }
    ]
  },
  "time": { "from": "now-6h", "to": "now" },
  "timepicker": {},
  "timezone": "browser",
  "title": "BoostAD 백엔드/프록시 모니터링",
  "uid": "boostad-backend",
  "version": 1,
  "weekStart": ""
}
