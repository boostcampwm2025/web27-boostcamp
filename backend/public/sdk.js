!function(){"use strict";const e=[{id:1,name:"JavaScript"},{id:2,name:"TypeScript"},{id:3,name:"Python"},{id:4,name:"Java"},{id:5,name:"Go"},{id:6,name:"Rust"},{id:7,name:"C++"},{id:8,name:"C#"},{id:9,name:"Kotlin"},{id:10,name:"Swift"},{id:11,name:"PHP"},{id:12,name:"Ruby"},{id:13,name:"React"},{id:14,name:"Vue"},{id:15,name:"Angular"},{id:16,name:"Svelte"},{id:17,name:"NextJS"},{id:18,name:"Nuxt"},{id:19,name:"Remix"},{id:20,name:"Astro"},{id:21,name:"SolidJS"},{id:22,name:"Preact"},{id:23,name:"Qwik"},{id:24,name:"NestJS"},{id:25,name:"Express"},{id:26,name:"Fastify"},{id:27,name:"Koa"},{id:28,name:"Spring"},{id:29,name:"Spring Boot"},{id:30,name:"Django"},{id:31,name:"Flask"},{id:32,name:"FastAPI"},{id:33,name:"Rails"},{id:34,name:"Laravel"},{id:35,name:"ASP.NET"},{id:36,name:"Gin"},{id:37,name:"Fiber"},{id:38,name:"MySQL"},{id:39,name:"PostgreSQL"},{id:40,name:"MongoDB"},{id:41,name:"Redis"},{id:42,name:"Elasticsearch"},{id:43,name:"Cassandra"},{id:44,name:"DynamoDB"},{id:45,name:"SQLite"},{id:46,name:"MariaDB"},{id:47,name:"Oracle"},{id:48,name:"SQL Server"},{id:49,name:"SQL"},{id:50,name:"Docker"},{id:51,name:"Kubernetes"},{id:52,name:"AWS"},{id:53,name:"GCP"},{id:54,name:"Azure"},{id:55,name:"Jenkins"},{id:56,name:"GitHub Actions"},{id:57,name:"GitLab CI"},{id:58,name:"CircleCI"},{id:59,name:"Terraform"},{id:60,name:"Ansible"},{id:61,name:"Nginx"},{id:62,name:"Apache"},{id:63,name:"Git"},{id:64,name:"GitHub"},{id:65,name:"GitLab"},{id:66,name:"Bitbucket"},{id:67,name:"npm"},{id:68,name:"Yarn"},{id:69,name:"pnpm"},{id:70,name:"Webpack"},{id:71,name:"Vite"},{id:72,name:"Rollup"},{id:73,name:"esbuild"},{id:74,name:"Babel"},{id:75,name:"ESLint"},{id:76,name:"Prettier"},{id:77,name:"REST"},{id:78,name:"GraphQL"},{id:79,name:"gRPC"},{id:80,name:"WebSocket"},{id:81,name:"tRPC"},{id:82,name:"Swagger"},{id:83,name:"Postman"},{id:84,name:"Jest"},{id:85,name:"Vitest"},{id:86,name:"Cypress"},{id:87,name:"Playwright"},{id:88,name:"Selenium"},{id:89,name:"JUnit"},{id:90,name:"Pytest"},{id:91,name:"Redux"},{id:92,name:"Zustand"},{id:93,name:"Recoil"},{id:94,name:"Jotai"},{id:95,name:"MobX"},{id:96,name:"React Query"},{id:97,name:"SWR"},{id:98,name:"React Native"},{id:99,name:"Flutter"},{id:100,name:"Electron"},{id:101,name:"Tauri"},{id:102,name:"AI"},{id:103,name:"Machine Learning"},{id:104,name:"TensorFlow"},{id:105,name:"PyTorch"},{id:106,name:"OpenAI"},{id:107,name:"Node.js"},{id:108,name:"Deno"},{id:109,name:"Bun"},{id:110,name:"Tailwind CSS"},{id:111,name:"Sass"},{id:112,name:"CSS"},{id:113,name:"HTML"},{id:114,name:"WebAssembly"},{id:115,name:"Blockchain"}];class n{constructor(e){this.tags=e}extract(){const e=(this.extractH1H2Text()+" "+this.extractTagsText()).toLowerCase(),n=this.tags.filter(n=>e.includes(n.name.toLowerCase()));return console.log("[DevAd SDK] 추출된 태그:",n),n}extractH1H2Text(){return[...Array.from(document.querySelectorAll("h1")),...Array.from(document.querySelectorAll("h2"))].map(e=>e.textContent||"").join(" ")}extractTagsText(){return Array.from(document.querySelectorAll(".tags .items a")).map(e=>e.textContent||"").join(" ")}}class t{constructor(e){this.config=e}async fetchDecision(e,n,t=0,i=!1){const a={blogKey:this.config.blogKey,tags:e.map(e=>e.name),postUrl:n,behaviorScore:t,isHighIntent:i};try{const e=await fetch(`${this.config.apiBase}/sdk/decision`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!e.ok)throw new Error(`API 오류: ${e.status} ${e.statusText}`);return await e.json()}catch(o){return console.error("[DevAd SDK] API 호출 실패:",o),{status:"error",message:"API 호출 실패",data:{campaign:null,auctionId:""},timestamp:(new Date).toISOString()}}}}class i{constructor(e){this.config=e,this.currentViewId=null,this.currentAdUrl=null}render(e,n,t,i,a,o){if(n.innerHTML=e?this.renderAdWidget(e):this.renderEmptyState(),e){this.currentAdUrl=e.url;const s=n.querySelector(".devad-link");null==s||s.addEventListener("click",e=>{e.preventDefault(),this.handleAdClick()}),this.trackCampaignView(t,e.id,i||window.location.href,a||0,o||!1)}}async trackCampaignView(e,n,t,i,a){try{const o={auctionId:e,campaignId:n,postUrl:t,isHighIntent:a,behaviorScore:i,positionRatio:null},s=await fetch(`${this.config.apiBase}/sdk/campaign-view`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(s.ok){const e=await s.json();this.currentViewId=e.data.viewId,console.log("[DevAd SDK] ViewLog 기록 성공:",e.data.viewId)}else console.warn("[DevAd SDK] ViewLog 기록 실패:",s.status)}catch(o){console.error("[DevAd SDK] ViewLog API 호출 실패:",o)}}async handleAdClick(){if(null!==this.currentViewId)try{const e={viewId:this.currentViewId},n=await fetch(`${this.config.apiBase}/sdk/campaign-click`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(n.ok){const e=await n.json();console.log("[DevAd SDK] ClickLog 기록 성공:",e.data.clickId)}else console.warn("[DevAd SDK] ClickLog 기록 실패:",n.status);this.currentAdUrl&&window.open(this.currentAdUrl,"_blank")}catch(e){console.error("[DevAd SDK] ClickLog API 호출 실패:",e),this.currentAdUrl&&window.open(this.currentAdUrl,"_blank")}else console.warn("[DevAd SDK] ViewLog가 아직 기록되지 않았습니다. ClickLog를 기록하지 않습니다.")}renderEmptyState(){return"\n      <div style=\"\n        padding: 20px;\n        text-align: center;\n        color: #999;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n        font-size: 14px;\n        border: 1px dashed #ddd;\n        border-radius: 8px;\n        background: #fafafa;\n      \">\n        매칭되는 광고가 없습니다\n      </div>\n    "}renderAdWidget(e){return`\n      <div class="devad-widget" style="\n        border: 1px solid #e0e0e0;\n        border-radius: 12px;\n        padding: 20px;\n        max-width: 400px;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n        background: #ffffff;\n        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n        transition: transform 0.2s, box-shadow 0.2s;\n      " onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 4px 16px rgba(0,0,0,0.15)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)';">\n\n        <div style="\n          font-size: 11px;\n          color: #999;\n          margin-bottom: 12px;\n          text-transform: uppercase;\n          letter-spacing: 0.5px;\n        ">\n          Sponsored\n        </div>\n\n        <img src="${e.image}" alt="${e.title}" style="\n          width: 100%;\n          border-radius: 8px;\n          margin-bottom: 16px;\n          object-fit: cover;\n          height: 200px;\n        " onerror="this.style.display='none';" />\n\n        <h3 style="\n          margin: 0 0 12px;\n          font-size: 20px;\n          font-weight: 600;\n          color: #333;\n          line-height: 1.4;\n        ">${e.title}</h3>\n\n        <p style="\n          margin: 0 0 16px;\n          color: #666;\n          font-size: 14px;\n          line-height: 1.6;\n        ">${e.content}</p>\n\n        <a href="${e.url}" class="devad-link" target="_blank" style="\n          display: inline-block;\n          padding: 10px 20px;\n          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n          color: white;\n          text-decoration: none;\n          border-radius: 6px;\n          font-size: 14px;\n          font-weight: 600;\n          transition: opacity 0.2s;\n          cursor: pointer;\n        " onmouseover="this.style.opacity='0.9';" onmouseout="this.style.opacity='1';">\n          자세히 보기 →\n        </a>\n\n        <div style="\n          margin-top: 16px;\n          padding-top: 16px;\n          border-top: 1px solid #f0f0f0;\n          font-size: 11px;\n          color: #aaa;\n        ">\n          Powered by <strong>DevAd</strong>\n        </div>\n      </div>\n    `}}class a{constructor(){this.metrics={scrollDepth:0,timeOnPage:0,copyEvents:0,score:0},this.startTime=0,this.timerInterval=null,this.thresholdReached=!1,this.thresholdCallback=null,this.handleScroll=()=>{const e=document.documentElement.scrollHeight,n=window.innerHeight,t=window.scrollY,i=this.metrics.scrollDepth,a=t/(e-n)*100;this.metrics.scrollDepth=Math.min(100,Math.max(0,a)),i<50&&this.metrics.scrollDepth>=50?console.log("[DevAd SDK] 스크롤 50% 달성 → +20점"):i<80&&this.metrics.scrollDepth>=80&&console.log("[DevAd SDK] 스크롤 80% 달성 → +30점 (총합)"),this.checkThreshold()},this.handleCopy=()=>{this.metrics.copyEvents++,console.log(`[DevAd SDK] 복사 이벤트 감지 (${this.metrics.copyEvents}회) → +${5*this.metrics.copyEvents}점`),this.checkThreshold()}}start(){this.startTime=Date.now(),window.addEventListener("scroll",this.handleScroll),document.addEventListener("copy",this.handleCopy),this.timerInterval=setInterval(()=>{this.metrics.timeOnPage=Math.floor((Date.now()-this.startTime)/1e3),this.checkThreshold()},1e3),console.log("[DevAd SDK] 행동 추적 시작")}stop(){window.removeEventListener("scroll",this.handleScroll),document.removeEventListener("copy",this.handleCopy),this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null),console.log("[DevAd SDK] 행동 추적 중지")}getCurrentScore(){return this.metrics.score}isHighIntent(){return this.metrics.score>=70}onThresholdReached(e){this.thresholdCallback=e}calculateScore(){let e=0;this.metrics.scrollDepth>=80?e+=30:this.metrics.scrollDepth>=50&&(e+=20);const n=this.metrics.timeOnPage/60;e+=Math.min(40,Math.floor(30*n)),e+=5*this.metrics.copyEvents,this.metrics.score=e}checkThreshold(){this.calculateScore(),!this.thresholdReached&&this.metrics.score>=70&&(this.thresholdReached=!0,console.log("[DevAd SDK] 70점 도달! 5초 후 2차 광고 요청... (현재:",this.metrics.score,"점)"),setTimeout(()=>{console.log("[DevAd SDK] 2차 광고 요청 실행 (최종 점수:",this.metrics.score,"점)"),this.thresholdCallback&&this.thresholdCallback()},5e3))}}class o{constructor(e,n,t,i){this.tagExtractor=e,this.apiClient=n,this.adRenderer=t,this.behaviorTracker=i,this.hasRequestedSecondAd=!1}async init(){const e=document.querySelectorAll("[data-devad-zone]");if(0===e.length)return void console.warn("[DevAd SDK] 광고 존을 찾을 수 없습니다. <div data-devad-zone></div>를 추가해주세요.");const n=this.tagExtractor.extract();console.log("[DevAd SDK] 추출된 태그:",n),0===n.length&&console.warn("[DevAd SDK] 태그를 추출하지 못했습니다. 광고 매칭이 잘 되지 않을 수 있습니다.");const t=window.location.href;e.forEach(async(e,i)=>{try{const i=await this.apiClient.fetchDecision(n,t,0,!1);this.adRenderer.render(i.data.campaign,e,i.data.auctionId,t,0,!1)}catch(a){console.error(`[DevAd SDK] Zone ${i+1} 렌더링 실패:`,a),e.innerHTML='<div style="color: red;">광고 로드 실패</div>'}}),this.behaviorTracker.onThresholdReached(()=>{this.requestSecondAd(n,t,e)}),this.behaviorTracker.start()}async requestSecondAd(e,n,t){if(this.hasRequestedSecondAd)return void console.log("[DevAd SDK] 2차 광고 이미 요청됨, 스킵");this.hasRequestedSecondAd=!0;const i=this.behaviorTracker.getCurrentScore(),a=this.behaviorTracker.isHighIntent();console.log("[DevAd SDK] 2차 광고 요청 - Score:",i,"HighIntent:",a),t.forEach(async(t,o)=>{try{const o=await this.apiClient.fetchDecision(e,n,i,a);this.adRenderer.render(o.data.campaign,t,o.data.auctionId,n,i,a)}catch(s){console.error(`[DevAd SDK] Zone ${o+1} 2차 광고 렌더링 실패:`,s)}})}}!function(){const s=function(){const e=document.currentScript;return{blogKey:(null==e?void 0:e.dataset.blogKey)||"unknown",apiBase:(null==e?void 0:e.dataset.apiBase)||"http://localhost:3000/api"}}(),r=new n(e),d=new t(s),c=new i(s),l=new a,m=new o(r,d,c,l);document.querySelector("[data-devad-zone]")?"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>m.init()):m.init():console.warn("[DevAd SDK] data-devad-zone 요소를 찾을 수 없습니다.")}()}();
