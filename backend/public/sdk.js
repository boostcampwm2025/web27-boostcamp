!function(){"use strict";const n=[{id:1,name:"JavaScript"},{id:2,name:"TypeScript"},{id:3,name:"React"},{id:4,name:"NextJS"},{id:5,name:"Spring"},{id:6,name:"NestJS"},{id:7,name:"SQL"},{id:8,name:"AWS"},{id:9,name:"Redis"},{id:10,name:"AI"}];class t{constructor(n){this.tags=n}extract(){var n;const t=(null==(n=document.querySelector("h1"))?void 0:n.textContent)||"",e=document.querySelector("article"),o=(t+" "+(e?e.textContent:document.body.textContent)).toLowerCase();return this.tags.filter(n=>o.includes(n.name.toLowerCase()))}}class e{constructor(n){this.config=n}async fetchDecision(n,t){const e={postId:this.config.blogId,tags:n.map(n=>n.name),postURL:t};try{const n=await fetch(`${this.config.apiBase}/b/decision`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!n.ok)throw new Error(`API 오류: ${n.status} ${n.statusText}`);return await n.json()}catch(o){return console.error("[DevAd SDK] API 호출 실패:",o),{winner:null,candidates:[]}}}}class o{constructor(n){this.config=n}render(n,t){if(t.innerHTML=n?this.renderAdWidget(n):this.renderEmptyState(),n){const e=t.querySelector(".devad-link");null==e||e.addEventListener("click",t=>{t.preventDefault(),this.handleAdClick(n)})}}async handleAdClick(n){try{const t=await fetch(`${this.config.apiBase}/click/track`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({campaignId:n.id,campaignName:n.title,url:n.url})});if(t.ok){const n=await t.json();window.open(n.redirectUrl,"_blank")}else window.open(n.url,"_blank")}catch(t){console.error("[DevAd SDK] Click tracking failed:",t),window.open(n.url,"_blank")}}renderEmptyState(){return"\n      <div style=\"\n        padding: 20px;\n        text-align: center;\n        color: #999;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n        font-size: 14px;\n        border: 1px dashed #ddd;\n        border-radius: 8px;\n        background: #fafafa;\n      \">\n        매칭되는 광고가 없습니다\n      </div>\n    "}renderAdWidget(n){return`\n      <div class="devad-widget" style="\n        border: 1px solid #e0e0e0;\n        border-radius: 12px;\n        padding: 20px;\n        max-width: 400px;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n        background: #ffffff;\n        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n        transition: transform 0.2s, box-shadow 0.2s;\n      " onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 4px 16px rgba(0,0,0,0.15)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)';">\n\n        <div style="\n          font-size: 11px;\n          color: #999;\n          margin-bottom: 12px;\n          text-transform: uppercase;\n          letter-spacing: 0.5px;\n        ">\n          Sponsored\n        </div>\n\n        <img src="${n.image}" alt="${n.title}" style="\n          width: 100%;\n          border-radius: 8px;\n          margin-bottom: 16px;\n          object-fit: cover;\n          height: 200px;\n        " onerror="this.style.display='none';" />\n\n        <h3 style="\n          margin: 0 0 12px;\n          font-size: 20px;\n          font-weight: 600;\n          color: #333;\n          line-height: 1.4;\n        ">${n.title}</h3>\n\n        <p style="\n          margin: 0 0 16px;\n          color: #666;\n          font-size: 14px;\n          line-height: 1.6;\n        ">${n.content}</p>\n\n        <a href="${n.url}" class="devad-link" target="_blank" style="\n          display: inline-block;\n          padding: 10px 20px;\n          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n          color: white;\n          text-decoration: none;\n          border-radius: 6px;\n          font-size: 14px;\n          font-weight: 600;\n          transition: opacity 0.2s;\n          cursor: pointer;\n        " onmouseover="this.style.opacity='0.9';" onmouseout="this.style.opacity='1';">\n          자세히 보기 →\n        </a>\n\n        <div style="\n          margin-top: 16px;\n          padding-top: 16px;\n          border-top: 1px solid #f0f0f0;\n          font-size: 11px;\n          color: #aaa;\n        ">\n          Powered by <strong>DevAd</strong>\n        </div>\n      </div>\n    `}}class i{constructor(n,t,e){this.tagExtractor=n,this.apiClient=t,this.adRenderer=e}async init(){const n=document.querySelectorAll("[data-devad-zone]");if(0===n.length)return void console.warn("[DevAd SDK] 광고 존을 찾을 수 없습니다. <div data-devad-zone></div>를 추가해주세요.");const t=this.tagExtractor.extract();console.log("[DevAd SDK] 추출된 태그:",t),0===t.length&&console.warn("[DevAd SDK] 태그를 추출하지 못했습니다. 광고 매칭이 잘 되지 않을 수 있습니다.");const e=window.location.href;n.forEach(async(n,o)=>{try{const o=await this.apiClient.fetchDecision(t,e);this.adRenderer.render(o.winner,n)}catch(i){console.error(`[DevAd SDK] Zone ${o+1} 렌더링 실패:`,i),n.innerHTML='<div style="color: red;">광고 로드 실패</div>'}})}}!function(){const a=function(){const n=document.currentScript;return{blogId:(null==n?void 0:n.dataset.blogId)||"unknown",apiBase:(null==n?void 0:n.dataset.apiBase)||"http://localhost:3000/api"}}(),r=new t(n),s=new e(a),d=new o(a),c=new i(r,s,d);document.querySelector("[data-devad-zone]")&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>c.init()):c.init()),window.DevAd={version:"0.1.0-prototype",config:a,sdk:c,setTagExtractor(n){c.tagExtractor=n,console.log("[DevAd SDK] 태그 추출기가 변경되었습니다")},setAdRenderer(n){c.adRenderer=n,console.log("[DevAd SDK] 광고 렌더러가 변경되었습니다")},reload(){c.init(),console.log("[DevAd SDK] SDK가 다시 로드되었습니다")},fetchDecision:async(n,t)=>s.fetchDecision(n,t),async trackClick(n,t,e){const o=await fetch(`${a.apiBase}/click/track`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({campaignId:n,campaignName:t,url:e})});if(!o.ok)throw new Error(`Failed to track click: ${o.statusText}`);return o.json()},async getClickLogs(n=10){const t=await fetch(`${a.apiBase}/click/logs?limit=${n}`);if(!t.ok)throw new Error(`Failed to fetch click logs: ${t.statusText}`);return t.json()}}}()}();
