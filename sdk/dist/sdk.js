!function(){"use strict";const e=[{id:1,name:"JavaScript"},{id:2,name:"TypeScript"},{id:3,name:"Python"},{id:4,name:"Java"},{id:5,name:"Go"},{id:6,name:"Rust"},{id:7,name:"C++"},{id:8,name:"C#"},{id:9,name:"Kotlin"},{id:10,name:"Swift"},{id:11,name:"PHP"},{id:12,name:"Ruby"},{id:13,name:"React"},{id:14,name:"Vue"},{id:15,name:"Angular"},{id:16,name:"Svelte"},{id:17,name:"NextJS"},{id:18,name:"Nuxt"},{id:19,name:"Remix"},{id:20,name:"Astro"},{id:21,name:"SolidJS"},{id:22,name:"Preact"},{id:23,name:"Qwik"},{id:24,name:"NestJS"},{id:25,name:"Express"},{id:26,name:"Fastify"},{id:27,name:"Koa"},{id:28,name:"Spring"},{id:29,name:"Spring Boot"},{id:30,name:"Django"},{id:31,name:"Flask"},{id:32,name:"FastAPI"},{id:33,name:"Rails"},{id:34,name:"Laravel"},{id:35,name:"ASP.NET"},{id:36,name:"Gin"},{id:37,name:"Fiber"},{id:38,name:"MySQL"},{id:39,name:"PostgreSQL"},{id:40,name:"MongoDB"},{id:41,name:"Redis"},{id:42,name:"Elasticsearch"},{id:43,name:"Cassandra"},{id:44,name:"DynamoDB"},{id:45,name:"SQLite"},{id:46,name:"MariaDB"},{id:47,name:"Oracle"},{id:48,name:"SQL Server"},{id:49,name:"SQL"},{id:50,name:"Docker"},{id:51,name:"Kubernetes"},{id:52,name:"AWS"},{id:53,name:"GCP"},{id:54,name:"Azure"},{id:55,name:"Jenkins"},{id:56,name:"GitHub Actions"},{id:57,name:"GitLab CI"},{id:58,name:"CircleCI"},{id:59,name:"Terraform"},{id:60,name:"Ansible"},{id:61,name:"Nginx"},{id:62,name:"Apache"},{id:63,name:"Git"},{id:64,name:"GitHub"},{id:65,name:"GitLab"},{id:66,name:"Bitbucket"},{id:67,name:"npm"},{id:68,name:"Yarn"},{id:69,name:"pnpm"},{id:70,name:"Webpack"},{id:71,name:"Vite"},{id:72,name:"Rollup"},{id:73,name:"esbuild"},{id:74,name:"Babel"},{id:75,name:"ESLint"},{id:76,name:"Prettier"},{id:77,name:"REST"},{id:78,name:"GraphQL"},{id:79,name:"gRPC"},{id:80,name:"WebSocket"},{id:81,name:"tRPC"},{id:82,name:"Swagger"},{id:83,name:"Postman"},{id:84,name:"Jest"},{id:85,name:"Vitest"},{id:86,name:"Cypress"},{id:87,name:"Playwright"},{id:88,name:"Selenium"},{id:89,name:"JUnit"},{id:90,name:"Pytest"},{id:91,name:"Redux"},{id:92,name:"Zustand"},{id:93,name:"Recoil"},{id:94,name:"Jotai"},{id:95,name:"MobX"},{id:96,name:"React Query"},{id:97,name:"SWR"},{id:98,name:"React Native"},{id:99,name:"Flutter"},{id:100,name:"Electron"},{id:101,name:"Tauri"},{id:102,name:"AI"},{id:103,name:"Machine Learning"},{id:104,name:"TensorFlow"},{id:105,name:"PyTorch"},{id:106,name:"OpenAI"},{id:107,name:"Node.js"},{id:108,name:"Deno"},{id:109,name:"Bun"},{id:110,name:"Tailwind CSS"},{id:111,name:"Sass"},{id:112,name:"CSS"},{id:113,name:"HTML"},{id:114,name:"WebAssembly"},{id:115,name:"Blockchain"}];class t{constructor(e){this.tags=e}extract(){const e=(this.extractH1H2Text()+" "+this.extractTagsText()).toLowerCase(),t=this.tags.filter(t=>e.includes(t.name.toLowerCase()));return console.log("[DevAd SDK] 추출된 태그:",t),t}extractH1H2Text(){return[...Array.from(document.querySelectorAll("h1")),...Array.from(document.querySelectorAll("h2"))].map(e=>e.textContent||"").join(" ")}extractTagsText(){const e=new Set;Array.from(document.querySelectorAll('a[rel="tag"]')).forEach(t=>{var n;const i=null==(n=t.textContent)?void 0:n.trim();i&&e.add(i)});Array.from(document.querySelectorAll('a[href*="/tag/"]')).forEach(t=>{var n;const i=null==(n=t.textContent)?void 0:n.trim();i&&e.add(i)});const t=[".box-tag",".article-tag",".tags",".tag-list",".entry-tags",'[class*="tag"]'];for(const n of t){document.querySelectorAll(n).forEach(t=>{t.querySelectorAll("a").forEach(t=>{var n;const i=null==(n=t.textContent)?void 0:n.trim();i&&e.add(i)})})}return Array.from(e).join(" ")}}class n{constructor(e){this.config=e}async fetchDecision(e,t,n=0,i=!1){const a={blogKey:this.config.blogKey,tags:e.map(e=>e.name),postUrl:t,behaviorScore:n,isHighIntent:i};try{const e=await fetch(`${this.config.apiBase}/sdk/decision`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!e.ok)throw new Error(`API 오류: ${e.status} ${e.statusText}`);return await e.json()}catch(o){return console.error("[DevAd SDK] API 호출 실패:",o),{status:"error",message:"API 호출 실패",data:{campaign:null,auctionId:""},timestamp:(new Date).toISOString()}}}}class i{constructor(e){this.config=e,this.currentViewId=null,this.currentAdUrl=null}render(e,t,n,i,a,o){if(t.innerHTML=e?this.renderAdWidget(e):this.renderEmptyState(),e){this.currentAdUrl=e.url;const r=t.querySelector(".devad-link");null==r||r.addEventListener("click",e=>{e.preventDefault(),this.handleAdClick()}),this.trackCampaignView(n,e.id,i||window.location.href,a||0,o||!1)}}async trackCampaignView(e,t,n,i,a){try{const o={auctionId:e,campaignId:t,postUrl:n,isHighIntent:a,behaviorScore:i,positionRatio:null},r=await fetch(`${this.config.apiBase}/sdk/campaign-view`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(r.ok){const e=await r.json();this.currentViewId=e.data.viewId,console.log("[DevAd SDK] ViewLog 기록 성공:",e.data.viewId)}else console.warn("[DevAd SDK] ViewLog 기록 실패:",r.status)}catch(o){console.error("[DevAd SDK] ViewLog API 호출 실패:",o)}}async handleAdClick(){if(null!==this.currentViewId)try{const e={viewId:this.currentViewId},t=await fetch(`${this.config.apiBase}/sdk/campaign-click`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(t.ok){const e=await t.json();console.log("[DevAd SDK] ClickLog 기록 성공:",e.data.clickId)}else console.warn("[DevAd SDK] ClickLog 기록 실패:",t.status);this.currentAdUrl&&window.open(this.currentAdUrl,"_blank")}catch(e){console.error("[DevAd SDK] ClickLog API 호출 실패:",e),this.currentAdUrl&&window.open(this.currentAdUrl,"_blank")}else console.warn("[DevAd SDK] ViewLog가 아직 기록되지 않았습니다. ClickLog를 기록하지 않습니다.")}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}renderEmptyState(){return"\n      <div style=\"\n        padding: 10px;\n        text-align: center;\n        color: #999;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n        font-size: 12px;\n        border: 1px dashed #ddd;\n        border-radius: 8px;\n        background: #fafafa;\n      \">\n        광고 없음\n      </div>\n    "}renderAdWidget(e){const t=this.escapeHtml(e.title),n=this.escapeHtml(e.content),i=this.escapeHtml(e.url);return`\n      <div class="devad-widget" style="\n        border: 1px solid #e0e0e0;\n        border-radius: 12px;\n        padding: 20px;\n        margin: 30px 0;\n        max-width: 100%;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n        background: #ffffff;\n        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n        transition: transform 0.2s, box-shadow 0.2s;\n      " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 16px rgba(0,0,0,0.15)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)';">\n\n        <div style="\n          font-size: 10px;\n          color: #999;\n          margin-bottom: 16px;\n          text-transform: uppercase;\n          letter-spacing: 0.5px;\n        ">\n          Sponsored\n        </div>\n\n        <div style="display: flex; flex-wrap: wrap; gap: 20px; align-items: stretch;">\n          <img src="${this.escapeHtml(e.image)}" alt="${t}" style="\n            max-width: 200px;\n            width: 100%;\n            aspect-ratio: 1/1;\n            border-radius: 8px;\n            object-fit: cover;\n            flex-shrink: 0;\n          " onerror="this.style.display='none';" />\n\n          <div style="flex: 1; min-width: 0; display: flex; flex-direction: column;">\n            <h3 style="\n              margin: 0 0 12px;\n              font-size: 20px;\n              font-weight: 600;\n              color: #333;\n              line-height: 1.4;\n            ">${t}</h3>\n\n            <p style="\n              margin: 0 0 16px;\n              color: #666;\n              font-size: 15px;\n              line-height: 1.6;\n            ">${n}</p>\n\n            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: auto;">\n              <a href="${i}" class="devad-link" target="_blank" rel="noopener noreferrer" style="\n                display: inline-block;\n                padding: 12px 24px;\n                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                color: white;\n                text-decoration: none;\n                border-radius: 8px;\n                font-size: 14px;\n                font-weight: 600;\n                transition: opacity 0.2s;\n                cursor: pointer;\n              " onmouseover="this.style.opacity='0.9';" onmouseout="this.style.opacity='1';">\n                자세히 보기 →\n              </a>\n\n              <span style="font-size: 11px; color: #aaa;">\n                by <strong>BoostAD</strong>\n              </span>\n            </div>\n          </div>\n        </div>\n      </div>\n    `}}class a{constructor(){this.metrics={scrollDepth:0,timeOnPage:0,copyEvents:0,score:0},this.startTime=0,this.timerInterval=null,this.thresholdReached=!1,this.thresholdCallback=null,this.handleScroll=()=>{const e=document.documentElement.scrollHeight,t=window.innerHeight,n=window.scrollY,i=this.metrics.scrollDepth,a=e-t,o=a>0?n/a*100:0,r=Math.min(100,Math.max(0,o));this.metrics.scrollDepth=Math.max(this.metrics.scrollDepth,r),i<50&&this.metrics.scrollDepth>=50?console.log("[DevAd SDK] 스크롤 50% 달성 → +20점"):i<80&&this.metrics.scrollDepth>=80&&console.log("[DevAd SDK] 스크롤 80% 달성 → +30점 (총합)"),this.checkThreshold()},this.handleCopy=()=>{this.metrics.copyEvents++,console.log(`[DevAd SDK] 복사 이벤트 감지 (${this.metrics.copyEvents}회) → +${5*this.metrics.copyEvents}점`),this.checkThreshold()}}start(){this.startTime=Date.now(),window.addEventListener("scroll",this.handleScroll),document.addEventListener("copy",this.handleCopy),this.timerInterval=setInterval(()=>{this.metrics.timeOnPage=Math.floor((Date.now()-this.startTime)/1e3),this.checkThreshold()},1e3),console.log("[DevAd SDK] 행동 추적 시작")}stop(){window.removeEventListener("scroll",this.handleScroll),document.removeEventListener("copy",this.handleCopy),this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null),console.log("[DevAd SDK] 행동 추적 중지")}getCurrentScore(){return this.metrics.score}isHighIntent(){return this.metrics.score>=70}onThresholdReached(e){this.thresholdCallback=e}calculateScore(){let e=0;this.metrics.scrollDepth>=80?e+=30:this.metrics.scrollDepth>=50&&(e+=20);const t=this.metrics.timeOnPage/60;e+=Math.min(40,Math.floor(30*t)),e+=5*this.metrics.copyEvents,this.metrics.score=e}checkThreshold(){this.calculateScore(),!this.thresholdReached&&this.metrics.score>=70&&(this.thresholdReached=!0,console.log("[DevAd SDK] 70점 도달! 5초 후 2차 광고 요청... (현재:",this.metrics.score,"점)"),setTimeout(()=>{console.log("[DevAd SDK] 2차 광고 요청 실행 (최종 점수:",this.metrics.score,"점)"),this.thresholdCallback&&this.thresholdCallback()},5e3))}}class o{constructor(e,t,n,i){this.tagExtractor=e,this.apiClient=t,this.adRenderer=n,this.behaviorTracker=i,this.hasRequestedSecondAd=!1,this.CONTENT_SELECTORS=[".article-view",".article-content",".post-content",".entry-content",".content","article",'[class*="content"]','[class*="article"]']}async init(){const e=this.tagExtractor.extract();console.log("[DevAd SDK] 추출된 태그:",e);const t=window.location.href,n=this.createAdContainer("devad-first-ad"),i=this.findContentTop();if(i){i.before(n);try{const i=await this.apiClient.fetchDecision(e,t,0,!1);this.adRenderer.render(i.data.campaign,n,i.data.auctionId,t,0,!1)}catch{n.innerHTML='<div style="color: #999; font-size: 14px; padding: 20px; text-align: center;">광고를 불러올 수 없습니다</div>'}}this.behaviorTracker.onThresholdReached(()=>{this.requestSecondAd(e,t)}),this.behaviorTracker.start()}createAdContainer(e){const t=document.createElement("div");return t.id=e,t.style.margin="30px 0",t}findContentTop(){for(const e of this.CONTENT_SELECTORS){const t=document.querySelector(e);if(t){const e=t.querySelector("p, h2");if(e)return e}}return null}findScrollBasedInsertionPoint(){let e=null;for(const d of this.CONTENT_SELECTORS)if(e=document.querySelector(d),e)break;if(!e)return null;const t=e.querySelectorAll("p");if(0===t.length)return null;const n=window.scrollY,i=window.innerHeight,a=n+i,o=e.getBoundingClientRect().bottom+n;if(a>o)return t[t.length-1];let r=null,s=1/0;return t.forEach(e=>{const t=e.getBoundingClientRect().top+n,i=Math.abs(t-a);i<s&&(s=i,r=e)}),r}async requestSecondAd(e,t){if(this.hasRequestedSecondAd)return;this.hasRequestedSecondAd=!0;const n=this.behaviorTracker.getCurrentScore(),i=this.behaviorTracker.isHighIntent();console.log("[DevAd SDK] 2차 광고 요청 - Score:",n,"HighIntent:",i);const a=document.getElementById("devad-first-ad");a&&a.remove();const o=this.createAdContainer("devad-second-ad"),r=this.findScrollBasedInsertionPoint();if(r){r.after(o);try{const a=await this.apiClient.fetchDecision(e,t,n,i);this.adRenderer.render(a.data.campaign,o,a.data.auctionId,t,n,i)}catch{o.innerHTML='<div style="color: #999; font-size: 14px; padding: 20px; text-align: center;">광고를 불러올 수 없습니다</div>'}}}}!function(){const r=function(){const e=document.currentScript;return{blogKey:(null==e?void 0:e.dataset.blogKey)||"unknown",apiBase:(null==e?void 0:e.dataset.apiBase)||"http://localhost:3000/api"}}(),s=new t(e),d=new n(r),c=new i(r),l=new a,m=new o(s,d,c,l);"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>m.init()):m.init()}()}();
