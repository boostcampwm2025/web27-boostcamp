!function(){"use strict";const e="https://localhost/api",t=[{id:1,name:"JavaScript"},{id:2,name:"TypeScript"},{id:3,name:"Python"},{id:4,name:"Java"},{id:5,name:"Go"},{id:6,name:"Rust"},{id:7,name:"C++"},{id:8,name:"C#"},{id:9,name:"Kotlin"},{id:10,name:"Swift"},{id:11,name:"PHP"},{id:12,name:"Ruby"},{id:13,name:"React"},{id:14,name:"Vue"},{id:15,name:"Angular"},{id:16,name:"Svelte"},{id:17,name:"NextJS"},{id:18,name:"Nuxt"},{id:19,name:"Remix"},{id:20,name:"Astro"},{id:21,name:"SolidJS"},{id:22,name:"Preact"},{id:23,name:"Qwik"},{id:24,name:"NestJS"},{id:25,name:"Express"},{id:26,name:"Fastify"},{id:27,name:"Koa"},{id:28,name:"Spring"},{id:29,name:"Spring Boot"},{id:30,name:"Django"},{id:31,name:"Flask"},{id:32,name:"FastAPI"},{id:33,name:"Rails"},{id:34,name:"Laravel"},{id:35,name:"ASP.NET"},{id:36,name:"Gin"},{id:37,name:"Fiber"},{id:38,name:"MySQL"},{id:39,name:"PostgreSQL"},{id:40,name:"MongoDB"},{id:41,name:"Redis"},{id:42,name:"Elasticsearch"},{id:43,name:"Cassandra"},{id:44,name:"DynamoDB"},{id:45,name:"SQLite"},{id:46,name:"MariaDB"},{id:47,name:"Oracle"},{id:48,name:"SQL Server"},{id:49,name:"SQL"},{id:50,name:"Docker"},{id:51,name:"Kubernetes"},{id:52,name:"AWS"},{id:53,name:"GCP"},{id:54,name:"Azure"},{id:55,name:"Jenkins"},{id:56,name:"GitHub Actions"},{id:57,name:"GitLab CI"},{id:58,name:"CircleCI"},{id:59,name:"Terraform"},{id:60,name:"Ansible"},{id:61,name:"Nginx"},{id:62,name:"Apache"},{id:63,name:"Git"},{id:64,name:"GitHub"},{id:65,name:"GitLab"},{id:66,name:"Bitbucket"},{id:67,name:"npm"},{id:68,name:"Yarn"},{id:69,name:"pnpm"},{id:70,name:"Webpack"},{id:71,name:"Vite"},{id:72,name:"Rollup"},{id:73,name:"esbuild"},{id:74,name:"Babel"},{id:75,name:"ESLint"},{id:76,name:"Prettier"},{id:77,name:"REST"},{id:78,name:"GraphQL"},{id:79,name:"gRPC"},{id:80,name:"WebSocket"},{id:81,name:"tRPC"},{id:82,name:"Swagger"},{id:83,name:"Postman"},{id:84,name:"Jest"},{id:85,name:"Vitest"},{id:86,name:"Cypress"},{id:87,name:"Playwright"},{id:88,name:"Selenium"},{id:89,name:"JUnit"},{id:90,name:"Pytest"},{id:91,name:"Redux"},{id:92,name:"Zustand"},{id:93,name:"Recoil"},{id:94,name:"Jotai"},{id:95,name:"MobX"},{id:96,name:"React Query"},{id:97,name:"SWR"},{id:98,name:"React Native"},{id:99,name:"Flutter"},{id:100,name:"Electron"},{id:101,name:"Tauri"},{id:102,name:"AI"},{id:103,name:"Machine Learning"},{id:104,name:"TensorFlow"},{id:105,name:"PyTorch"},{id:106,name:"OpenAI"},{id:107,name:"Node.js"},{id:108,name:"Deno"},{id:109,name:"Bun"},{id:110,name:"Tailwind CSS"},{id:111,name:"Sass"},{id:112,name:"CSS"},{id:113,name:"HTML"},{id:114,name:"WebAssembly"},{id:115,name:"Blockchain"}];class n{constructor(e){this.tags=e}extract(){const e=(this.extractH1H2Text()+" "+this.extractTagsText()).toLowerCase(),t=this.tags.filter(t=>e.includes(t.name.toLowerCase()));return console.log("[BoostAD SDK] 추출된 태그:",t),t}extractH1H2Text(){return[...Array.from(document.querySelectorAll("h1")),...Array.from(document.querySelectorAll("h2"))].map(e=>e.textContent||"").join(" ")}extractTagsText(){const e=new Set;Array.from(document.querySelectorAll('a[rel="tag"]')).forEach(t=>{var n;const i=null==(n=t.textContent)?void 0:n.trim();i&&e.add(i)});Array.from(document.querySelectorAll('a[href*="/tag/"]')).forEach(t=>{var n;const i=null==(n=t.textContent)?void 0:n.trim();i&&e.add(i)});const t=[".box-tag",".article-tag",".tags",".tag-list",".entry-tags",'[class*="tag"]'];for(const n of t){document.querySelectorAll(n).forEach(t=>{t.querySelectorAll("a").forEach(t=>{var n;const i=null==(n=t.textContent)?void 0:n.trim();i&&e.add(i)})})}return Array.from(e).join(" ")}}class i{constructor(e){this.config=e}async fetchDecision(t,n,i=0,o=!1){const r={blogKey:this.config.blogKey,tags:t.map(e=>e.name),postUrl:n,behaviorScore:i,isHighIntent:o};try{const t=await fetch(`${e}/sdk/decision`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(r)});if(!t.ok)throw new Error(`API 오류: ${t.status} ${t.statusText}`);return await t.json()}catch(s){return console.error("[BoostAD SDK] API 호출 실패:",s),{status:"error",message:"API 호출 실패",data:{campaign:null,auctionId:""},timestamp:(new Date).toISOString()}}}}class o{constructor(e){this.blogKey=e,this.currentViewId=null,this.currentAdUrl=null}render(e,t,n,i,o,r){if(t.innerHTML=e?this.renderAdWidget(e,t):this.renderEmptyState(),e){this.currentAdUrl=e.url;const s=t.querySelector(".boostad-link");null==s||s.addEventListener("click",e=>{e.preventDefault(),this.handleAdClick()}),this.trackCampaignView(n,e.id,i||window.location.href,o||0,r||!1)}}async trackCampaignView(t,n,i,o,r){try{const s={blogKey:this.blogKey,auctionId:t,campaignId:n,postUrl:i,isHighIntent:r,behaviorScore:o,positionRatio:null},a=await fetch(`${e}/sdk/campaign-view`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(s)});if(a.ok){const e=await a.json();this.currentViewId=e.data.viewId,console.log("[BoostAD SDK] ViewLog 기록 성공:",e.data.viewId)}else console.warn("[BoostAD SDK] ViewLog 기록 실패:",a.status)}catch(s){console.error("[BoostAD SDK] ViewLog API 호출 실패:",s)}}async handleAdClick(){if(null!==this.currentViewId)try{const t={viewId:this.currentViewId,blogKey:this.blogKey,postUrl:window.location.href},n=await fetch(`${e}/sdk/campaign-click`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)});if(n.ok){const e=await n.json();e.data.clickId?console.log("[BoostAD SDK] ClickLog 기록 성공:",e.data.clickId):console.log("[BoostAD SDK] 중복 클릭으로 판단되어 예산이 차감되지 않습니다.")}else console.warn("[BoostAD SDK] ClickLog 기록 실패:",n.status);this.currentAdUrl&&window.open(this.currentAdUrl,"_blank")}catch(t){console.error("[BoostAD SDK] ClickLog API 호출 실패:",t),this.currentAdUrl&&window.open(this.currentAdUrl,"_blank")}else console.warn("[BoostAD SDK] ViewLog가 아직 기록되지 않았습니다. ClickLog를 기록하지 않습니다.")}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}renderEmptyState(){return"\n      <div style=\"\n        padding: 10px;\n        text-align: center;\n        color: #999;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n        font-size: 12px;\n        border: 1px dashed #ddd;\n        border-radius: 8px;\n        background: #fafafa;\n      \">\n        광고 없음\n      </div>\n    "}renderAdWidget(e,t){const n=this.escapeHtml(e.title),i=this.escapeHtml(e.content),o=this.escapeHtml(e.url),r=this.escapeHtml(e.image),s=t.offsetHeight||t.clientHeight;return s>0&&s<=120?this.renderCompactWidget(n,i,o,r):s>120&&s<=200?this.renderMediumWidget(n,i,o,r):this.renderFullWidget(n,i,o,r)}renderCompactWidget(e,t,n,i){return`\n      <a href="${n}" class="boostad-link" target="_blank" rel="noopener noreferrer" style="\n        display: flex;\n        align-items: center;\n        gap: 12px;\n        height: 100%;\n        padding: 8px 12px;\n        border: 1px solid #e0e0e0;\n        border-radius: 8px;\n        background: #ffffff;\n        text-decoration: none;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n        box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);\n        transition: box-shadow 0.2s;\n        box-sizing: border-box;\n      " onmouseover="this.style.boxShadow='0 2px 8px rgba(0,0,0,0.12)';" onmouseout="this.style.boxShadow='0 1px 4px rgba(0,0,0,0.08)';">\n        <img src="${i}" alt="${e}" style="\n          width: 48px;\n          height: 48px;\n          border-radius: 6px;\n          object-fit: cover;\n          flex-shrink: 0;\n        " onerror="this.style.display='none';" />\n        <div style="flex: 1; min-width: 0; overflow: hidden;">\n          <div style="\n            font-size: 13px;\n            font-weight: 600;\n            color: #333;\n            white-space: nowrap;\n            overflow: hidden;\n            text-overflow: ellipsis;\n          ">${e}</div>\n          <div style="font-size: 10px; color: #999; margin-top: 2px;">Sponsored by BoostAD</div>\n        </div>\n        <span style="\n          padding: 6px 12px;\n          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n          color: white;\n          border-radius: 6px;\n          font-size: 12px;\n          font-weight: 600;\n          white-space: nowrap;\n          flex-shrink: 0;\n        ">보기</span>\n      </a>\n    `}renderMediumWidget(e,t,n,i){return`\n      <div class="boostad-widget" style="\n        display: flex;\n        align-items: center;\n        gap: 16px;\n        height: 100%;\n        padding: 12px 16px;\n        border: 1px solid #e0e0e0;\n        border-radius: 10px;\n        background: #ffffff;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);\n        box-sizing: border-box;\n      ">\n        <img src="${i}" alt="${e}" style="\n          width: 80px;\n          height: 80px;\n          border-radius: 8px;\n          object-fit: cover;\n          flex-shrink: 0;\n        " onerror="this.style.display='none';" />\n        <div style="flex: 1; min-width: 0; overflow: hidden;">\n          <div style="font-size: 10px; color: #999; margin-bottom: 4px;">Sponsored</div>\n          <div style="\n            font-size: 15px;\n            font-weight: 600;\n            color: #333;\n            white-space: nowrap;\n            overflow: hidden;\n            text-overflow: ellipsis;\n            margin-bottom: 4px;\n          ">${e}</div>\n          <div style="\n            font-size: 12px;\n            color: #666;\n            white-space: nowrap;\n            overflow: hidden;\n            text-overflow: ellipsis;\n          ">${t}</div>\n        </div>\n        <a href="${n}" class="boostad-link" target="_blank" rel="noopener noreferrer" style="\n          padding: 10px 20px;\n          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n          color: white;\n          text-decoration: none;\n          border-radius: 8px;\n          font-size: 13px;\n          font-weight: 600;\n          white-space: nowrap;\n          flex-shrink: 0;\n        ">자세히 보기</a>\n      </div>\n    `}renderFullWidget(e,t,n,i){return`\n      <div class="boostad-widget" style="\n        border: 1px solid #e0e0e0;\n        border-radius: 12px;\n        padding: 20px;\n        margin: 30px 0;\n        max-width: 100%;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n        background: #ffffff;\n        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n        transition: transform 0.2s, box-shadow 0.2s;\n      " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 16px rgba(0,0,0,0.15)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)';">\n\n        <div style="\n          font-size: 10px;\n          color: #999;\n          margin-bottom: 16px;\n          text-transform: uppercase;\n          letter-spacing: 0.5px;\n        ">\n          Sponsored\n        </div>\n\n        <div style="display: flex; flex-wrap: wrap; gap: 20px; align-items: stretch;">\n          <img src="${i}" alt="${e}" style="\n            width: 200px;\n            height: 200px;\n            border-radius: 8px;\n            object-fit: cover;\n            flex-shrink: 0;\n          " onerror="this.style.display='none';" />\n\n          <div style="flex: 1; min-width: 0; display: flex; flex-direction: column;">\n            <h3 style="\n              margin: 0 0 12px;\n              font-size: 20px;\n              font-weight: 600;\n              color: #333;\n              line-height: 1.4;\n            ">${e}</h3>\n\n            <p style="\n              margin: 0 0 24px;\n              color: #666;\n              font-size: 15px;\n              line-height: 1.6;\n              flex-grow: 1;\n            ">${t}</p>\n\n            <div style="\n              display: flex;\n              justify-content: space-between;\n              align-items: center;\n              margin-top: auto;\n              padding-top: 16px;\n              gap: 12px;\n            ">\n              <a href="${n}" class="boostad-link" target="_blank" rel="noopener noreferrer" style="\n                display: inline-block;\n                padding: 12px 24px;\n                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                color: white;\n                text-decoration: none;\n                border-radius: 8px;\n                font-size: 14px;\n                font-weight: 600;\n                transition: opacity 0.2s;\n                cursor: pointer;\n                white-space: nowrap;\n              " onmouseover="this.style.opacity='0.9';" onmouseout="this.style.opacity='1';">\n                자세히 보기 →\n              </a>\n\n              <span style="font-size: 11px; color: #aaa; white-space: nowrap;">\n                by <strong>BoostAD</strong>\n              </span>\n            </div>\n          </div>\n        </div>\n      </div>\n    `}}class r{constructor(){this.metrics={scrollDepth:0,timeOnPage:0,copyEvents:0,codeBlockCopies:0,score:0},this.startTime=0,this.timerInterval=null,this.thresholdReached=!1,this.thresholdCallback=null,this.handleScroll=()=>{const e=document.documentElement.scrollHeight,t=window.innerHeight,n=window.scrollY,i=this.metrics.scrollDepth,o=e-t,r=o>0?n/o*100:0,s=Math.min(100,Math.max(0,r));this.metrics.scrollDepth=Math.max(this.metrics.scrollDepth,s),i<50&&this.metrics.scrollDepth>=50?console.log("[BoostAD SDK] 스크롤 50% 달성 → +20점"):i<80&&this.metrics.scrollDepth>=80&&console.log("[BoostAD SDK] 스크롤 80% 달성 → +30점 (총합)"),this.checkThreshold()},this.handleCopy=()=>{const e=window.getSelection();this.isSelectionInCodeBlock(e)?(this.metrics.codeBlockCopies++,console.log(`[BoostAD SDK] 코드 블록 복사 감지 (${this.metrics.codeBlockCopies}회) → +${15*this.metrics.codeBlockCopies}점`)):(this.metrics.copyEvents++,console.log(`[BoostAD SDK] 일반 복사 이벤트 감지 (${this.metrics.copyEvents}회) → +${5*this.metrics.copyEvents}점`)),this.checkThreshold()}}start(){this.startTime=Date.now(),window.addEventListener("scroll",this.handleScroll),document.addEventListener("copy",this.handleCopy),this.timerInterval=setInterval(()=>{this.metrics.timeOnPage=Math.floor((Date.now()-this.startTime)/1e3),this.checkThreshold()},1e3),console.log("[BoostAD SDK] 행동 추적 시작")}stop(){window.removeEventListener("scroll",this.handleScroll),document.removeEventListener("copy",this.handleCopy),this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null),console.log("[BoostAD SDK] 행동 추적 중지")}getCurrentScore(){return this.metrics.score}isHighIntent(){return this.metrics.score>=70}onThresholdReached(e){this.thresholdCallback=e}isSelectionInCodeBlock(e){if(!e||0===e.rangeCount)return!1;let t=e.getRangeAt(0).commonAncestorContainer;for(;t&&t!==document.body;){if(t.nodeType===Node.ELEMENT_NODE){const e=t,n=e.tagName.toUpperCase();if("PRE"===n||"CODE"===n)return!0;const i=e.className||"";if(i.includes("code")||i.includes("hljs")||i.includes("language-")||i.includes("highlight"))return!0}t=t.parentNode}return!1}calculateScore(){let e=0;this.metrics.scrollDepth>=80?e+=30:this.metrics.scrollDepth>=50&&(e+=20);const t=this.metrics.timeOnPage/60;e+=Math.min(40,Math.floor(30*t)),e+=5*this.metrics.copyEvents,e+=15*this.metrics.codeBlockCopies,this.metrics.score=e}checkThreshold(){this.calculateScore(),!this.thresholdReached&&this.metrics.score>=70&&(this.thresholdReached=!0,console.log("[BoostAD SDK] 70점 도달! 5초 후 2차 광고 요청... (현재:",this.metrics.score,"점)"),setTimeout(()=>{console.log("[BoostAD SDK] 2차 광고 요청 실행 (최종 점수:",this.metrics.score,"점)"),this.thresholdCallback&&this.thresholdCallback()},5e3))}}class s{constructor(e,t,n,i,o){this.tagExtractor=e,this.apiClient=t,this.adRenderer=n,this.behaviorTracker=i,this.isAutoMode=o,this.hasRequestedSecondAd=!1,this.mutationObserver=null,this.renderedZones=new Set,this.behaviorTrackerStarted=!1,this.debounceTimer=null,this.CONTENT_SELECTORS=["#area_view","#article-view","#mArticle",".blogview_content",".article-view",".article-content",".post-content",".entry-content",".content","article",'[class*="content"]','[class*="article"]']}async init(){this.isAutoMode?await this.initAutoMode():await this.initManualMode()}async fetchAndRenderAd(e,t,n,i,o){try{const r=await this.apiClient.fetchDecision(t,n,i,o);if(!r||!r.data||!r.data.campaign)return console.warn("[BoostAD SDK] 표시할 광고가 없습니다."),void(e.innerHTML='<div style="color: #999; font-size: 14px; padding: 20px; text-align: center;">표시할 광고가 없습니다</div>');this.adRenderer.render(r.data.campaign,e,r.data.auctionId,n,i,o)}catch(r){console.error("[BoostAD SDK] 광고 로드 실패:",r),e.innerHTML='<div style="color: #999; font-size: 14px; padding: 20px; text-align: center;">광고를 불러올 수 없습니다</div>'}}createAdContainer(e){const t=document.createElement("div");return t.id=e,t.style.margin="30px 0",t}async initAutoMode(){if(!this.isPostPage())return;const e=this.tagExtractor.extract(),t=window.location.href,n=this.createAdContainer("boostad-first-ad"),i=this.findContentTop();i&&(i.before(n),await this.fetchAndRenderAd(n,e,t,0,!1)),this.behaviorTracker.onThresholdReached(()=>{this.requestSecondAdAutoMode(e,t)}),this.behaviorTracker.start()}async requestSecondAdAutoMode(e,t){var n;if(this.hasRequestedSecondAd)return;this.hasRequestedSecondAd=!0;const i=this.behaviorTracker.getCurrentScore(),o=this.behaviorTracker.isHighIntent();null==(n=document.getElementById("boostad-first-ad"))||n.remove();const r=this.createAdContainer("boostad-second-ad"),s=this.findScrollBasedInsertionPoint();s&&(s.after(r),await this.fetchAndRenderAd(r,e,t,i,o))}isPostPage(){const e=window.tistory;if(e)return"post"===e.type;const t=window.location.pathname;return!["/admin","/manage","/login","/signup"].some(e=>t.startsWith(e))}findContentTop(){for(const e of this.CONTENT_SELECTORS){const t=document.querySelector(e);if(t){const e=t.querySelector("p, h2");if(e)return e}}return null}findScrollBasedInsertionPoint(){let e=null;for(const d of this.CONTENT_SELECTORS)if(e=document.querySelector(d),e)break;if(!e)return console.warn("[BoostAD SDK] 본문 영역을 찾을 수 없습니다"),null;const t=e.querySelectorAll("p");if(0===t.length)return console.warn("[BoostAD SDK] <p> 태그를 찾을 수 없습니다"),null;const n=window.scrollY,i=window.innerHeight,o=n+i,r=e.getBoundingClientRect().bottom+n;if(o>r)return t[t.length-1];let s=null,a=1/0;return t.forEach(e=>{const t=e.getBoundingClientRect().top+n,i=Math.abs(t-o);i<a&&(a=i,s=e)}),s}async initManualMode(){await this.checkAndLoadAds(),this.setupMutationObserver()}setupMutationObserver(){this.mutationObserver=new MutationObserver(()=>{this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.checkAndLoadAds()},100)}),this.mutationObserver.observe(document.body,{childList:!0,subtree:!0})}async checkAndLoadAds(){const e=document.querySelectorAll("[data-boostad-zone]");if(0===e.length)return;const t=Array.from(e).filter(e=>!this.renderedZones.has(e));0!==t.length&&await this.loadAdsForZones(t)}async loadAdsForZones(e){const t=e.slice(0,2);e.length>2&&console.warn(`[BoostAD SDK] 광고존은 최대 2개까지 허용됩니다. ${e.length}개 중 처음 2개만 사용합니다.`),t.forEach(e=>this.renderedZones.add(e));const n=this.tagExtractor.extract(),i=window.location.href;for(const o of t){const e=o;e.style.margin="30px 0",await this.fetchAndRenderAd(e,n,i,0,!1)}this.behaviorTrackerStarted||(this.behaviorTrackerStarted=!0,this.behaviorTracker.onThresholdReached(()=>{this.requestSecondAdManualMode(n,i,Array.from(this.renderedZones))}),this.behaviorTracker.start())}async requestSecondAdManualMode(e,t,n){if(this.hasRequestedSecondAd)return;this.hasRequestedSecondAd=!0;const i=this.behaviorTracker.getCurrentScore(),o=this.behaviorTracker.isHighIntent();console.log("[BoostAD SDK] 2차 광고 요청 - Score:",i,"HighIntent:",o),n.forEach(async n=>{const r=n;r.innerHTML="",await this.fetchAndRenderAd(r,e,t,i,o)})}}!function(){const e=function(){const e=document.currentScript,t=null==e?void 0:e.dataset.auto;return{blogKey:(null==e?void 0:e.dataset.blogKey)||"unknown",auto:void 0===t||"true"===t}}(),a=new n(t),d=new i(e),c=new o(e.blogKey),l=new r,h=new s(a,d,c,l,e.auto);console.log(`[BoostAD SDK] ${e.auto?"자동":"수동"} 모드로 초기화됩니다.`),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>h.init()):h.init()}()}();
